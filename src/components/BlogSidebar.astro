---
---

<aside class="space-y-6">
  <!-- Newsletter -->
  <div class="rounded-2xl border border-border/60 bg-card p-6">
    <div class="flex items-center gap-3 mb-3">
      <svg class="w-6 h-6 text-blue-500 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
      </svg>
      <h3 class="font-bold text-foreground text-base">Newsletter</h3>
    </div>
    <p class="text-sm text-muted-foreground mb-4">
      Nie wieder wichtige KI News verpassen
    </p>
    <form class="space-y-3" id="sidebar-newsletter-form">
      <input
        type="email"
        name="email"
        placeholder="Ihre E-Mail"
        required
        class="w-full px-3 py-2 text-sm rounded-md border border-input bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary"
      />
      <label class="flex items-start gap-2 text-xs text-muted-foreground cursor-pointer">
        <input
          type="checkbox"
          name="consent"
          required
          class="mt-0.5 rounded border-input bg-background text-primary focus:ring-2 focus:ring-primary"
        />
        <span>
          Ich stimme der <a href="/datenschutz" class="text-primary hover:underline">Datenschutzerklärung</a> zu und möchte den Newsletter erhalten.*
        </span>
      </label>
      <button
        type="submit"
        class="inline-flex items-center justify-center w-full gap-2 px-4 py-2.5 text-sm font-medium text-white rounded-[5px] bg-blue-600 hover:bg-blue-700 transition-colors disabled:opacity-50"
      >
        Anmelden
      </button>
      <p class="text-xs text-center hidden success-message" style="color: #10b981;">
        Vielen Dank! Sie erhalten bald unseren Newsletter.
      </p>
      <p class="text-xs text-center hidden error-message" style="color: #ef4444;">
        Fehler beim Anmelden. Bitte versuchen Sie es später erneut.
      </p>
    </form>
  </div>

  <!-- Interessante Artikel -->
  <div class="rounded-2xl border border-border/60 bg-card p-6">
    <h3 class="font-bold text-foreground text-base mb-4">Interessante Artikel</h3>
    <div class="space-y-3">
      <a
        href="/blog/moltbot-anwendungsfaelle"
        class="block group"
      >
        <h4 class="text-sm font-medium text-foreground group-hover:text-primary transition-colors line-clamp-2">
          Moltbot Anwendungsfälle & Use Cases
        </h4>
      </a>
      <div class="border-t border-border/60"></div>
      <a
        href="/blog/ist-moltbot-sicher"
        class="block group"
      >
        <h4 class="text-sm font-medium text-foreground group-hover:text-primary transition-colors line-clamp-2">
          Ist Moltbot sicher? Sicherheitsanalyse
        </h4>
      </a>
      <div class="border-t border-border/60"></div>
      <a
        href="/blog/moltbot-mac-mini"
        class="block group"
      >
        <h4 class="text-sm font-medium text-foreground group-hover:text-primary transition-colors line-clamp-2">
          Moltbot auf dem Mac mini betreiben
        </h4>
      </a>
    </div>
  </div>

  <!-- KI Beratung -->
  <div class="rounded-2xl border border-border/60 bg-card p-6">
    <h3 class="font-bold text-foreground text-base mb-2">KI Beratung</h3>
    <p class="text-sm text-muted-foreground mb-4">
      Wir analysieren Ihr Geschäft, identifizieren KI-Potenziale und begleiten Sie bis zur erfolgreichen Implementierung.
    </p>
    <a
      href="/ki-beratung"
      class="inline-flex items-center justify-center w-full gap-2 px-4 py-2.5 text-sm font-medium text-white rounded-[5px] bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 transition-all"
    >
      Kostenlose Erstberatung
    </a>
  </div>
</aside>

<script>
  const form = document.getElementById('sidebar-newsletter-form') as HTMLFormElement;
  const successMsg = form?.querySelector('.success-message');
  const errorMsg = form?.querySelector('.error-message');
  const submitBtn = form?.querySelector('button[type="submit"]') as HTMLButtonElement;

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = new FormData(form);
    const email = formData.get('email') as string;

    if (!email) return;

    // Disable button
    if (submitBtn) submitBtn.disabled = true;

    try {
      const response = await fetch('/.netlify/functions/subscribe', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          email: email,
          source: 'Sidebar'
        })
      });

      const data = await response.json();

      if (response.ok) {
        successMsg?.classList.remove('hidden');
        errorMsg?.classList.add('hidden');
        form.reset();

        setTimeout(() => {
          successMsg?.classList.add('hidden');
        }, 5000);
      } else {
        throw new Error(data.error || 'Subscription failed');
      }
    } catch (error) {
      console.error('Newsletter signup error:', error);
      errorMsg?.classList.remove('hidden');
      successMsg?.classList.add('hidden');
    } finally {
      if (submitBtn) submitBtn.disabled = false;
    }
  });
</script>
